swagger: "2.0"
info:
  version: "2.0"
  title: A proxy API which ferries requests to the Watson Engagement Advisor (WEA) 3.0 API
# during dev, should point to your local machine
host: localhost:10010
# basePath prefixes all resource paths 
basePath: /v2
# 
schemes:
  # tip: remove http to make production-grade
  - http
  - https
# format of bodies a client can send (Content-Type)
consumes:
  - application/json
# format of the responses to the client (Accepts)
produces:
  - application/json
paths:
  /workspaces/{workspace_id}/message:
    
    x-swagger-router-controller: proxy_controller
    post:
      description: Posts a message to the WEA 3.0 API. Proxy wrappers may chose to interept requests and/or responses before/after making the request to the WEA 3.0 API.
      # used as the method name of the controller
      operationId: message
      #
      parameters: 
      - name: workspace_id
        description: An id used to identify the Dialog V2 workspace to send the request to
        in: "path"
        required: true
        type: string
      - name: input
        in: body
        description: The input payload from the client, may contain state, tags and user input
        required: true
        schema:
          $ref: "#/definitions/MessageRequest"
      
      responses:
        "200":
          examples:
            application/json: |-
              {
                "intents": [
                  {
                    "intent_id": "pizza",
                    "confidence": 0.94302
                  }
                ],
                "entities": [
                  {
                    "entity_id": "toppings",
                    "value": "pepperoni",
                    "location": [
                      21,
                      30
                    ]
                  }
                ],
                "output": {
                  "text": ["Great"," would you like anything else on your pizza?"]
                },
                "state": {
                  "dialog_node_id": "pizza_order",
                  "conversation_id": "2a47d342",
                  "toppings": [
                    "pepperoni"
                  ]
                }
              }
          description: Success
          schema:
            # a pointer to a definition
            $ref: "#/definitions/MessageResponse"
        # responses may fall through to errors
        default:
          description: Error
          schema:
            $ref: "#/definitions/ErrorResponse"
  /swagger:
    x-swagger-pipe: swagger_raw
# complex objects have schema definitions
definitions:
  MessageRequest:
    description: WEA 3.0 request object
    properties:
      input:
         $ref: "#/definitions/UserInput"
         description: User input/utterance
      tags:
         type: array
         description: Tags which may be used to filter response possibilities
         items:
            type: string
      state:
          type: object
          description: Dialog state object. Key value pairs may be passed in with each call. The state from the previous response must be passed in at a minimum.
  MessageResponse:
    required:
      - intents
      - entities
      - output
      - state
    properties:
      intents:
        description: Intents as identified by the WEA 3.0 service
        type: array
        items: 
          $ref: "#/definitions/MessageIntent"
      entities:
        description: Entities as identified by the WEA 3.0 service
        type: array
        items:
           $ref: "#/definitions/MessageEntity"
      output:
        $ref: "#/definitions/MessageOutput"
      state:
        description: State as returned by WEA 3.0 service. The client must store this state and pass it in (either modified or unmodified) with the next response
        type: object
        additionalProperties:
          type: string
    
  MessageIntent:
    properties:
       intent_id: 
            type: "string"
       confidence: 
            type: "number"
            format: "double"
  MessageEntity:
    properties:
       entity_id: 
            type: "string"
       value: 
            type: "string"
       location:
            type: "array"
            items:
              type: "integer"
            maxItems: 2
            minItems: 2
  MessageOutput:
    description: The textual output from the WEA service
    properties:
        text:
           type: "string"
  UserInput:
    description: The textual input from the end user
    properties:
        text:
           type: "string"
  
  ErrorResponse:
    required:
      - message
    properties:
      message:
        type: string
